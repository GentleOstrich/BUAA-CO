### 设计草稿

新增HILO模块

|端口|方向|位宽|功能|
|--|--|--|--|
|clk|input|1|时钟
|reset|input|1|复位
|start_i|input|1|开始执行乘除功能信号
|op|input|[3:0]|乘除功能类型
|D1|input|[31:0]|rs的运算数
|D2|input|[31:0]|rt的运算数
|we|input|[1:0]|是否直接写HILO寄存器
|wd|input|[31:0]|直接写入HILO寄存器的值
|HI|output|[31:0]|HI寄存器的值
|LO|output|[31:0]|LO寄存器的值
|busy|output|1|正在工作
|start_o|output|1|正在开始工作

新增DATAEXT模块
|端口|方向|位宽|功能|
|--|--|--|--|
|Op|input|[2:0]]|一次判断
|A|input|[1:0]|二次判断
|Din|input|[31:0]]|待处理数据
|Dout|output|[31:0]]|处理后数据

数据通路变化略

### 测试样例
```
    lui $t1, 100
    mult $t1, $t1
    mflo $t2
    sw $t1, 0($0)
    lw $t3, 0($0)
    mult $t2, $t3
    mtlo $t1
    mflo $t2
    beq $t2, $t1, label
```
### 思考题
1、为什么需要有单独的乘除法部件而不是整合进 ALU？为何需要有独立的 HI、LO 寄存器？
```
    因为乘除运算用时长，使用单独的乘除法部件不会影响后续与此乘除指令无关的指令的进行，可以提高流水线性能。使用独立的HI、LO寄存器保存乘除法运算的值也是为了提高流水线性能。
```
2、真实的流水线 CPU 是如何使用实现乘除法的？请查阅相关资料进行简单说明。
```
    真实的流水线CPU中的乘除法不是组合逻辑，而是时序逻辑。
```
3、请结合自己的实现分析，你是如何处理 Busy 信号带来的周期阻塞的？
```
    HILO模块接收到start_i==1的信号后，根据收到的乘除法信号将内部timer寄存器置为5或10，同时busy置为1。将E级HILO模块产生的start_o信号和busy信号传给D级CTRL模块，若此时D级模块的指令是MULT等与HILO模块有关的指令，则进行阻塞。
```
4、请问采用字节使能信号的方式处理写指令有什么好处？（提示：从清晰性、统一性等角度考虑）
```
    清晰性提高，四位信号，哪位为1，哪位写入内存地址中。统一性提高，不同的指令均可以使用四位信号统一驱动。
```
5、请思考，我们在按字节读和按字节写时，实际从 DM 获得的数据和向 DM 写入的数据是否是一字节？在什么情况下我们按字节读和按字节写的效率会高于按字读和按字写呢？
```
    按字节读不是一字节，按字节写是一字节。按字节读什么情况下效率都不会高于按字读，sh和sb按字节写高于按字写。
```
6、为了对抗复杂性你采取了哪些抽象和规范手段？这些手段在译码和处理数据冲突的时候有什么样的特点与帮助？
```
    把会引发相同冒险冲突的指令归为一类。简化测试样例的编写，便于写出更为全面的样例。
```
7、在本实验中你遇到了哪些不同指令类型组合产生的冲突？你又是如何解决的？相应的测试样例是什么样的？
```
    对于新增指令：
    or, slt, sltu 和 add, sub, and, lui 引发的冒险是相同的，无需额外考虑新增指令会不会带来额外的冲突；
    addi, andi, ori 这几个指令引发的冒险是相同的，无需额外考虑新增指令会不会带来额外的冲突；
    lb, lh 和 lw 引发的冒险是相同的，无需额外考虑新增指令会不会带来额外的冲突；
    sb, sh 和 sw 引发的冒险是相同的，无需额外考虑新增指令会不会带来额外的冲突；
    bne 和 beq 引发的冒险是相同的，无需额外考虑新增指令会不会带来额外的冲突；
    所以，只需要考虑 mult, multu, div, divu, mfhi, mflo, mthi, mtlo 与其他指令组合时会不会带来额外的冲突。

    lui $t1, 100
    mult $t1, $t1
    mflo $t2
    sw $t1, 0($0)
    lw $t3, 0($0)
    mult $t2, $t3
    mtlo $t1
    mflo $t2
    beq $t2, $t1, label
```
8、如果你是手动构造的样例，请说明构造策略，说明你的测试程序如何保证覆盖了所有需要测试的情况；如果你是完全随机生成的测试样例，请思考完全随机的测试程序有何不足之处；如果你在生成测试样例时采用了特殊的策略，比如构造连续数据冒险序列，请你描述一下你使用的策略如何结合了随机性达到强测的效果。
```
    lui类、sw类、beq类分别与新增的mfhi mflo组合
```